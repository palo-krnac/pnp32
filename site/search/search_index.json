{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\ud83c\udfaf pnp32 Modular Motion Controller for openPNP","text":"<p>High-performance, fully modular motion controller for advanced Pick &amp; Place machines. Designed to seamlessly integrate with OpenPnP and support direct SPI-controlled stepper drivers for ultra-smooth and precise motion.</p>"},{"location":"#key-features","title":"\ud83d\ude80 Key Features","text":"<ul> <li>\u2705 ESP32 \u2014 powerful microcontroller with floating-point, high-speed I/O, and robust connectivity</li> <li>\u2705 Native SPI motion control \u2014 supports TMC5160, TMC5130 drivers without STEP/DIR emulation</li> <li>\u2705 Flexible architecture \u2014 single-board and multi-board configurations for scalable machine designs</li> <li>\u2705 CAN bus interface \u2014 robust communication between multiple controllers or modular head units</li> <li>\u2705 RS485 interface \u2014 control feeder modules or additional peripherals with industrial reliability</li> <li>\u2705 Integrated vacuum and air control \u2014 including pressure/vacuum sensing and smart valve control</li> <li>\u2705 Advanced lighting and vision control \u2014 supports multi-channel LED lighting, camera triggers, and auxiliary outputs</li> <li>\u2705 USB-to-Serial bridge \u2014 direct communication with OpenPnP software</li> </ul>"},{"location":"#modifications-configurations","title":"\ud83e\udde9 Modifications &amp; Configurations","text":""},{"location":"#modification-1-single-board-setup","title":"\ud83d\udd39 Modification 1: Single Board Setup","text":"<ul> <li>All stepper motor drivers for all axes integrated on one board</li> <li>Centralized control logic with all communication interfaces (CAN, RS485, USB)</li> <li>Simplified wiring for smaller or simpler machines</li> </ul>"},{"location":"#modification-2-dual-board-modular-setup","title":"\ud83d\udd39 Modification 2: Dual Board Modular Setup","text":""},{"location":"#main-controller-board","title":"\ud83d\udfe6 Main Controller Board","text":"<ul> <li>Controls primary machine axes: X, Y, or duplicated X + single Y (up to 3 axes)</li> <li>Handles all communication interfaces (CAN, RS485, USB)</li> <li>Acts as the master motion controller</li> </ul>"},{"location":"#head-controller-board","title":"\ud83d\udfe9 Head Controller Board","text":"<ul> <li>Mounted on the machine head(s), connected via CAN bus</li> <li>Controls additional axes: Z, A, B, C, D, E, F</li> <li>Supports air/vacuum control, pressure/vacuum sensing</li> <li>Controls head lighting, glue/paste dispensers</li> <li>Available in two variants:</li> <li>2-head version: for two nozzles</li> <li>4-head version: supports four nozzles or combination of nozzles &amp; dispensers</li> </ul>"},{"location":"#g-code-configuration-machine-parameters","title":"\u2699\ufe0f G-code Configuration &amp; Machine Parameters","text":"<p>All key motion parameters and hardware configurations are set directly from OpenPnP via custom G-code commands. This enables easy tuning, calibration, and reconfiguration without modifying firmware or recompiling code.</p>"},{"location":"#supported-g-code-commands","title":"\ud83d\udcac Supported G-code Commands","text":"G-code Description Example Usage Documentation <code>M350</code> Set microstepping for each axis <code>M350 X16 Y16 Z32</code> RepRap M350 <code>M906</code> Set motor current (mA) per axis <code>M906 X1000 Y1000 Z800</code> RepRap M906 <code>M92</code> Set steps per mm (axis scaling) <code>M92 X80 Y80 Z400</code> RepRap M92 <code>M211</code> Enable/disable software endstops <code>M211 S1</code> RepRap M211 <code>M208</code> Set axis travel limits (soft limits) <code>M208 X0:300 Y0:250 Z0:150</code> Duet3D M208 <code>M569</code> Configure driver direction inversion <code>M569 X0 Y1 Z0</code> Duet3D M569 <code>M912</code> Set driver sense resistor calibration <code>M912 X20 Y20 Z18</code> Custom command <code>M913</code> Set dynamic current scaling % <code>M913 X70 Y70 Z80</code> Duet3D M913 <code>M950</code> Configure pin assignments for outputs <code>M950 P1 S0</code> Duet3D M950"},{"location":"#possible-additional-configurations","title":"\ud83d\udee0 Possible Additional Configurations","text":"<ul> <li>Set acceleration, max speed, and jerk per axis (future extension)</li> <li>Configure vacuum thresholds and pressure sensor calibration</li> <li>Assign specific CAN node IDs for multi-board setups</li> <li>Control glue/paste pump parameters (pulse lengths, flow rates)</li> <li>Define custom tool offsets and head calibration parameters</li> </ul>"},{"location":"#board-parameters","title":"\ud83d\udee0 Board Parameters","text":"Parameter Value MCU ESP32-S3 Motor Drivers SPI controlled: TMC5160, TMC5130 Axes Up to 12 axes total (depending on config) Feeders Up to 63 feeders total (depending on config) Comm. Interfaces CAN bus, RS485, USB-Serial Peripheral Control Air/vacuum valves, pressure sensors, lighting Voltage 12\u201348 V supply for motors Safety E-stop input, software limits, watchdog"},{"location":"#board-types","title":"\ud83d\udee0 Board Types","text":"Parameter Driver_XY Driver_Z Driver AB Driver CD pnp32_MCB_A ESP32-S3 af sfa FAF pnp32_MCB_B REFRF AREF AERF SPI controlled: TMC5160, TMC5130 Axes AERF AREF RFAER Up to 12 axes total (depending on config) Feeders AER AERF AERF Up to 63 feeders total (depending on config) Comm. Interfaces ARF AREF ARF CAN bus, RS485, USB-Serial Peripheral Control RF ARF ARF Air/vacuum valves, pressure sensors, lighting Voltage ARF AR AFR 12\u201348 V supply for motors Safety SFAS ARFAE ARFAR E-stop input, software limits, watchdog"},{"location":"#software","title":"\ud83d\udcbb Software","text":"<ul> <li>Developed in PlatformIO</li> <li>Custom motion control firmware optimized for SPI-based drivers</li> <li>CAN bus stack for modular multi-board communication</li> <li>Feeder and peripheral control via RS485</li> <li>OpenPnP-compatible serial communication with dynamic G-code support</li> </ul>"},{"location":"#highlights","title":"\ud83d\udca1 Highlights","text":"<ul> <li>Ultra-precise motion with direct register-level SPI control (no missed steps)</li> <li>Full machine configuration and tuning via standard G-code from OpenPnP</li> <li>Modular design ready for scalable, high-end Pick &amp; Place machines</li> <li>Multi-head and multi-function ready: placement, glue dispensing, paste dispensing</li> <li>Designed for tinkerers, prosumers, and professional machine builders alike</li> </ul>"},{"location":"#getting-started","title":"\ud83d\udce6 Getting Started","text":"<p>1\ufe0f\u20e3 Clone this repository 2\ufe0f\u20e3 Install PlatformIO and dependencies 3\ufe0f\u20e3 Configure your hardware via G-code or <code>config.h</code> for base defaults 4\ufe0f\u20e3 Flash the firmware to your controller board 5\ufe0f\u20e3 Connect to OpenPnP and start tuning!</p>"},{"location":"#license","title":"\ud83d\udee1 License","text":"<p>This project is open-source under the MIT License. Contributions and pull requests are warmly welcome!</p>"},{"location":"#credits-inspiration","title":"\u2764\ufe0f Credits &amp; Inspiration","text":"<p>Inspired by OpenPnP community, modern motion control concepts, and the open hardware spirit. Special thanks to Trinamic (TMC), STMicroelectronics (PowerSTEP01, L64xx), and the global DIY PnP community.</p>"},{"location":"#screenshots-diagrams","title":"\u2728 Screenshots &amp; Diagrams","text":"<p>(Insert board design images, modular connection diagrams, example machine setups, head modules, etc.)</p>"},{"location":"#ready-to-go-lets-build-next-level-openpnp-machines-together","title":"\u2705 Ready to go? Let's build next-level OpenPnP machines together!","text":"<p>\"\"\"</p>"},{"location":"FIRMWARE/firmware/","title":"Firmware Overview","text":"<p>Welcome to the firmware section overview.</p>"},{"location":"HARDWARE/TMC5130/","title":"TMC5130","text":"<p>Silent stepper motor cDriver 4.75 to 46V, up to 1.4ARMS with SPI Interface, 256 \u00b5Steps, SixPoint ramp controller, SpreadCycle and Stealthchop </p> <p></p> <p>TMC5130 Block Diagram \u2014 detailed overview of block architecture</p>"},{"location":"HARDWARE/TMC5160/","title":"TMC5160","text":"<p>Stepper motor cDriver 8 to 60V, for external N-Fets with S/D and SPI Interface, 256 \u00b5Steps, SixPoint ramp controller, CoolStep, StallGuard2, SpreadCycle and StealthChop2 </p> <p></p> <p>TMC5160 Block Diagram \u2014 detailed overview of block architecture</p> <p>    TMC5160 Datasheet </p> <p>    TMC5160 Official Website </p>"},{"location":"HARDWARE/TMC5160/#key-features","title":"Key Features","text":"<ul> <li>2-phase stepper motors from 1 to several 10A coil current</li> <li>Motion Controller with SixPoint\u2122 ramp</li> <li>Step/Dir Interface with microstep interpolation MicroPlyer\u2122</li> <li>Voltage Range 8 to 60V DC</li> <li>SPI &amp; Single Wire UART</li> <li>Encoder Interface and 2x Ref.-Switch Input</li> <li>Highest Resolution 256 microsteps per full step</li> <li>StealthChop2\u2122 for quiet operation and smooth motion</li> <li>Passive Braking and freewheeling mode</li> <li>Resonance Dampening for mid-range resonances</li> <li>SpreadCycle\u2122 highly dynamic motor control chopper</li> <li>cStep\u2122 load dependent speed control</li> <li>StallGuard2\u2122 high precision sensorless motor load detection</li> <li>CoolStep\u2122 current control for energy savings up to 75%</li> <li>Full Protection &amp; Diagnostics</li> <li>Compact Size 7x7mm2 (body) TQFP48 package / 8x8mm\u00b2 QFN</li> </ul>"},{"location":"HARDWARE/hardware/","title":"Hardware Overview","text":"<p>Welcome to the hardware section overview.</p>"},{"location":"HARDWARE/hardware/#stepper-drivers","title":"Stepper drivers","text":""},{"location":"HARDWARE/hardware/#powerstep01","title":"powerSTEP01","text":"<ul> <li>System-in-package integrating microstepping controller and 10 A power MOSFETs</li> </ul> <p>    PowerSTEP01 Datasheet </p>"},{"location":"HARDWARE/hardware/#key-features","title":"Key Features","text":"<ul> <li>Power system-in-package integrating a programmable microstepping controller and 8 N-channel power MOSFETs</li> <li>Operating voltage: 7.5 V - 85 V</li> <li>Dual full-bridge with RDS(on) = 16 m\u03a9</li> <li>10 ARMS maximum output current</li> <li>Adjustable output slew rate</li> <li>Programmable speed profile</li> <li>Up to 1/128 microstepping</li> <li>Sensorless stall detection</li> <li>Integrated voltage regulators</li> <li>SPI interface</li> <li>Low quiescent standby current</li> <li>Programmable non-dissipative overcurrent protection</li> <li>Overtemperature protection</li> </ul>"},{"location":"HARDWARE/powerstep01/","title":"power","text":""},{"location":"openPNP/actuators_code/","title":"Actuators codes","text":""},{"location":"openPNP/actuators_code/#air-blower-codes","title":"Air blower codes","text":""},{"location":"openPNP/actuators_code/#m8-air-blower-enable","title":"M8 - air blower enable","text":"Command Parameter Description M8 Pn air ON <p>Examples</p> <pre><code>M8 P1   ; enable air blower P1\n</code></pre>"},{"location":"openPNP/actuators_code/#m9-air-blower-disable","title":"M9 - air blower disable","text":"Command Parameter Description M9 Pn air OFF <p>Examples</p> <pre><code>M9 P1   ; disable air blower P1\n</code></pre>"},{"location":"openPNP/actuators_code/#vacuum-codes","title":"Vacuum codes","text":""},{"location":"openPNP/actuators_code/#m10-vacuum-pump-enable","title":"M10 - vacuum pump enable","text":"Command Parameter Description M10 Pn vacuum ON <p>Examples</p> <pre><code>M10 P1   ; enable vacuum pump P1\n</code></pre>"},{"location":"openPNP/actuators_code/#m11-vacuum-pump-disable","title":"M11 - vacuum pump disable","text":"Command Parameter Description M11 Pn vacuum OFF <p>Examples</p> <pre><code>M11 P1   ; disable vacuum pump P1\n</code></pre>"},{"location":"openPNP/actuators_code/#solenoids-codes","title":"Solenoids codes","text":""},{"location":"openPNP/actuators_code/#m380-enable-solenoids","title":"M380 - enable solenoids","text":"Command Parameter Description M380 Sn solenoid ON <p>Examples</p> <pre><code>M380 P1   ; set pump to No.1 nozzle\n</code></pre>"},{"location":"openPNP/actuators_code/#m381-disable-solenoids","title":"M381 - disable solenoids","text":"Command Parameter Description M380 Sn solenoid OFF <p>Examples</p> <pre><code>M381 P1   ; set pump to No.1 nozzle\n</code></pre>"},{"location":"openPNP/actuators_code/#lights-codes","title":"Lights codes","text":""},{"location":"openPNP/actuators_code/#m150-set-led-color","title":"M150 - set led color","text":"Command Parameter Description M150 Rnnn Red component M150 Unnn Green component M150 Bnnn Blue component M150 Wnnn White component M150 Pnnn Brightness (0\u2013255) M150 Snnn Number of individual LEDs to set to these colours M150 Fn Following command action. F0 (default) means this is the last command for the LED strip, so the next M150 command starts at the beginning of the strip. F1 means further M150 commands for the remainder of the strip follow this one. <p>Examples</p> <pre><code>M150 R255 P128 S20 F1    ; set first 20 LEDs to red, half brightness, more commands for the strip follow\nM150 U255 B255 P255 S20  ; set next 20 LEDs to cyan, full brightness, finished programming LED strip\n</code></pre>"},{"location":"openPNP/actuators_code/#sounds-codes","title":"Sounds codes","text":""},{"location":"openPNP/actuators_code/#m300-play-beep-sound","title":"M300 - play beep sound","text":"Command Parameter Description M300 Snnn frequency in Hz M300 Pnnn duration in millisecond M300 Vnnn volume in rage 0 - 1 <p>Examples</p> <pre><code>M300 P153 S659 ; MUSIC Start\nM300 P149 S659\nM300 P148 S0\nM300 P148 S659\nM300 P154 S0\nM300 P149 S523\nM300 P148 S659\nM300 P149 S0\nM300 P154 S784 ; MUSIC END\n</code></pre>"},{"location":"openPNP/basic_code/","title":"Basic codes","text":""},{"location":"openPNP/basic_code/#g0-g1-move","title":"G0 &amp; G1: Move","text":""},{"location":"openPNP/basic_code/#description","title":"Description","text":"<p>Add a straight line movement to the planner.</p> <ul> <li>G0: Rapid Move (fast, non-precise)</li> <li>G1: Linear Move (controlled, precise)</li> </ul>"},{"location":"openPNP/basic_code/#usage","title":"Usage","text":"<p>G0 Xnnn Ynnn Znnn Ennn Fnnn Snnn G1 Xnnn Ynnn Znnn Ennn Fnnn Snnn</p>"},{"location":"openPNP/basic_code/#parameters","title":"Parameters","text":"Parameter Description Xnnn Target position on the X axis Ynnn Target position on the Y axis Znnn Target position on the Z axis Ennn Amount to extrude between start and end Fnnn Feedrate (mm/min) for the move Hnnn Endstop check flag (RepRapFirmware) Rnnn Restore point number (RepRapFirmware) Snnn Laser power or similar (context-specific) <p>\u2139\ufe0f Note: Not all parameters are required, but at least one position parameter must be specified.</p>"},{"location":"openPNP/basic_code/#examples","title":"Examples","text":"<p>```gcode G0 X12               ; Move rapidly to X = 12 mm G0 F1500             ; Set rapid feedrate to 1500 mm/min G1 X90.6 Y13.8 E22.4 ; Move and extrude</p>"},{"location":"openPNP/basic_code/#g21","title":"G21","text":""},{"location":"openPNP/basic_code/#g90","title":"G90","text":""},{"location":"openPNP/basic_code/#g92","title":"G92","text":""},{"location":"openPNP/basic_code/#m114","title":"M114","text":""},{"location":"openPNP/basic_code/#m115","title":"M115","text":""},{"location":"openPNP/commands/","title":"Default","text":""},{"location":"openPNP/commands/#connect_command","title":"CONNECT_COMMAND","text":"<pre><code>G21 ; Set millimeters mode\nG90 ; Set absolute positioning mode\n</code></pre>"},{"location":"openPNP/commands/#enable_command","title":"ENABLE_COMMAND","text":"<pre><code>G21 ; Set millimeters mode\nG90 ; Set absolute positioning mode\nM82 ; extruder in absolute mode\nM300 P153 S659 ; MUSIC Start\nM300 P149 S659\nM300 P148 S0\nM300 P148 S659\nM300 P154 S0\nM300 P149 S523\nM300 P148 S659\nM300 P149 S0\nM300 P154 S784 ; MUSIC END\n</code></pre>"},{"location":"openPNP/commands/#disable_command","title":"DISABLE_COMMAND","text":"<pre><code>M114; Report position\nM84; DISABLE MOTORS\n</code></pre>"},{"location":"openPNP/commands/#home_command","title":"HOME_COMMAND","text":"<pre><code>M300 P149 S400; Beep\nG1 A0 B0; Rotate A B nozzles to 0\u00b0\nM400;\nM114; Report position\nM84; Disable motors\nG4 P1000; Pause 1.0s\nM204 S1000; Set homing acceleration\nG28 X Y A B; Homing X Y A B\nM400; Finish moves\nG92 X0 Y352 A0 B0; Set X Y A B home position\nM114; Report redefined position\nG1 X95 Y334 F12000; Move X Y to safe zone where nozzle can go to the lowest point.\nG28 Z; Homing Z\nG1 Z1.2; Move Z to middle height(Adjust if needed)\nM400; Finish moves\nG92 Z0 ; Set current Z height to 0(Middle)\nM114; Report redefined position\nG1 Z0; Move Z to middle height\nM400; Finish moves\nG92 Z0; Set Z home position to 0\nM114; Report redefined position\n</code></pre>"},{"location":"openPNP/commands/#command_confirm_regex","title":"COMMAND_CONFIRM_REGEX","text":"<pre><code>^ok.*\n</code></pre>"},{"location":"openPNP/commands/#position_report_regex","title":"POSITION_REPORT_REGEX","text":"<pre><code>^.*X:(?&lt;X&gt;-?\\d+\\.\\d+) Y:(?&lt;Y&gt;-?\\d+\\.\\d+) Z:(?&lt;Z&gt;-?\\d+\\.\\d+) A:(?&lt;A&gt;-?\\d+\\.\\d+) B:(?&lt;B&gt;-?\\d+\\.\\d+).*\n</code></pre>"},{"location":"openPNP/commands/#command_error_regex","title":"COMMAND_ERROR_REGEX","text":"<pre><code>^ok.*\n</code></pre>"},{"location":"openPNP/machine_code/","title":"Machine Parameters","text":""},{"location":"openPNP/machine_code/#limits","title":"Limits","text":"Command Example M211 <code>M211 S1</code> M208 <code>M208 X0:300 Y0:250</code>"},{"location":"openPNP/machine_code/#tool-offsets-others","title":"Tool offsets &amp; others","text":"Command Example M420 <code>M420 S1</code> M950 <code>M950 P1 S0</code>"},{"location":"openPNP/machine_code/#m906","title":"M906","text":""},{"location":"openPNP/machine_code/#m909","title":"M909","text":""},{"location":"openPNP/machine_code/#_1","title":"Machine codes","text":""},{"location":"openPNP/safety_code/","title":"\u26a0\ufe0f Safety Tips","text":"<p>Before using G-code, please read carefully.</p>"},{"location":"openPNP/safety_code/#emergency-stop","title":"\ud83d\uded1 Emergency Stop","text":"<ul> <li>Always have easy access to E-stop</li> <li>Test E-stop regularly</li> </ul>"},{"location":"openPNP/safety_code/#pneumatics-vacuum","title":"\ud83d\udca8 Pneumatics &amp; Vacuum","text":"<ul> <li>Ensure air lines are secure</li> <li>Test vacuum sensors before running auto cycles</li> </ul>"},{"location":"openPNP/safety_code/#lights-cameras","title":"\ud83d\udca1 Lights &amp; Cameras","text":"<ul> <li>Avoid high-power lighting tests without shielding</li> <li>Check camera focus before Z moves</li> </ul> <p>\ud83d\udcac Tip: Start with low speeds (<code>F1000</code>) when tuning.</p>"}]}